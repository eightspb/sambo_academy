# 📊 Расширенная статистика

## ✨ Что добавлено

Страница статистики полностью переработана и теперь включает три раздела:
1. **📊 Посещаемость** - статистика по группам и общая
2. **💰 Платежи** - финансовая статистика
3. **❌ Неоплаченные** - список учеников без оплаты

---

## 🎯 Новая функциональность

### 1. 📊 Вкладка "Посещаемость"

**Что отображается:**

**Общая статистика:**
- Всего отметок
- Присутствовали
- Отсутствовали
- Процент посещаемости

**Статистика по группам:**
- Название группы
- Всего отметок
- Присутствовали
- Отсутствовали
- Перенос
- % Посещаемости

**Фильтры:**
- Год
- Месяц

### 2. 💰 Вкладка "Платежи"

**Что отображается:**

**Годовая статистика:**
- Общая сумма за год
- Всего платежей
- Средняя сумма в месяц

**Помесячная статистика:**
- Месяц
- Сумма
- Количество платежей
- Оплачено
- Ожидается
- Просрочено

**Фильтры:**
- Год

### 3. ❌ Вкладка "Неоплаченные"

**Что отображается:**

**Сводка:**
- Количество не оплативших за месяц

**Список учеников:**
- № п/п
- ФИО
- Группа
- Телефон
- Email
- Действия (кнопка "Позвонить")

**Фильтры:**
- Год
- Месяц

---

## 💡 Примеры использования

### Пример 1: Проверка посещаемости за октябрь

**Действия:**
1. Откройте **Статистика**
2. Вкладка **"Посещаемость"** (открыта по умолчанию)
3. Выберите **Год: 2025**, **Месяц: Октябрь**
4. ✅ Видите общую и по-групповую статистику

**Что увидите:**
- Всего отметок: 450
- Присутствовали: 380 (84%)
- Отсутствовали: 50 (11%)
- Перенос: 20 (5%)

**По группам:**
```
Группа              | Всего | Присут. | Отсут. | Перенос | %
─────────────────────────────────────────────────────────────
Старшие ПН-СР-ПТ    |  150  |   130   |   15   |    5    | 87%
Младшие ВТ-ЧТ       |  120  |   100   |   18   |    2    | 83%
...
```

### Пример 2: Проверка платежей за год

**Действия:**
1. Переключитесь на вкладку **"Платежи"**
2. Выберите **Год: 2025**
3. ✅ Видите годовую и помесячную статистику

**Что увидите:**
- Общая сумма за 2025: 1,250,000₽
- Всего платежей: 360
- Средняя сумма в месяц: 104,166₽

### Пример 3: Кто не оплатил за октябрь

**Действия:**
1. Переключитесь на вкладку **"Неоплаченные"**
2. Выберите **Год: 2025**, **Месяц: Октябрь**
3. ✅ Видите список неоплативших

**Что увидите:**
```
Не оплатили за Октябрь: 5

№ | ФИО           | Группа          | Телефон        | Email
─────────────────────────────────────────────────────────────
1 | Иванов Иван   | Старшие ПН-СР-ПТ| +79991234567   | ivan@...
2 | Петрова Мария | Младшие ВТ-ЧТ   | +79997654321   | maria@...
...
```

**Действия:**
- Нажмите **"📞 Позвонить"** → откроется звонилка

---

## 🔧 Технические детали

### Backend (новые API endpoints):

#### 1. Статистика посещаемости
```
GET /api/attendance/statistics/summary?year=2025&month=10
```

**Ответ:**
```json
{
  "year": 2025,
  "month": 10,
  "groups": [
    {
      "group_id": "uuid",
      "group_name": "Старшие ПН-СР-ПТ",
      "total_sessions": 150,
      "present": 130,
      "absent": 15,
      "transferred": 5,
      "attendance_rate": 86.67
    }
  ],
  "overall": {
    "total_sessions": 450,
    "present": 380,
    "absent": 50,
    "transferred": 20,
    "attendance_rate": 84.44
  }
}
```

#### 2. Список неоплативших
```
GET /api/payments/unpaid-students?year=2025&month=10
```

**Ответ:**
```json
{
  "year": 2025,
  "month": 10,
  "total_unpaid": 5,
  "students": [
    {
      "student_id": "uuid",
      "full_name": "Иванов Иван",
      "group_name": "Старшие ПН-СР-ПТ",
      "phone": "+79991234567",
      "email": "ivan@example.com"
    }
  ]
}
```

### Frontend:

**Вкладочный интерфейс:**
- 3 вкладки с независимым контентом
- Динамическое переключение фильтров
- Автоматическая загрузка данных при смене вкладки

**JavaScript функции:**
- `switchTab(tab)` - переключение вкладок
- `loadCurrentTabData()` - загрузка данных текущей вкладки
- `loadAttendanceStats()` - загрузка статистики посещаемости
- `loadPaymentStats()` - загрузка статистики платежей
- `loadUnpaidStudents()` - загрузка неоплативших
- `renderAttendanceStats(stats)` - отображение посещаемости
- `renderPaymentStats(stats, year)` - отображение платежей
- `renderUnpaidStudents(data)` - отображение неоплативших

---

## 📊 Интерфейс

### Вкладки:
```
┌────────────────────────────────────────────────────────┐
│ [📊 Посещаемость] [💰 Платежи] [❌ Неоплаченные]        │
│                                                         │
│ Год: [2025 ▼]  Месяц: [Октябрь ▼]                     │
└────────────────────────────────────────────────────────┘
```

### Посещаемость:
```
┌──────────────────────────────────────────────────────┐
│ Всего отметок: 450                                   │
│ Присутствовали: 380 | Отсутствовали: 50 | 84% ✅    │
├──────────────────────────────────────────────────────┤
│ Статистика по группам:                               │
│ Старшие ПН-СР-ПТ    150  130  15   5   87%         │
│ Младшие ВТ-ЧТ       120  100  18   2   83%         │
└──────────────────────────────────────────────────────┘
```

### Платежи:
```
┌──────────────────────────────────────────────────────┐
│ Общая сумма: 1,250,000₽ | Платежей: 360 | Средн: 104K│
├──────────────────────────────────────────────────────┤
│ Помесячная статистика:                               │
│ Январь    105,000₽   30   28   2   0               │
│ Февраль   110,000₽   32   30   1   1               │
└──────────────────────────────────────────────────────┘
```

### Неоплаченные:
```
┌──────────────────────────────────────────────────────┐
│ Не оплатили за Октябрь: 5 ❌                         │
├──────────────────────────────────────────────────────┤
│ № ФИО            Группа       Телефон    [Позвонить]│
│ 1 Иванов Иван    Старшие...   +7999...   [📞]       │
│ 2 Петрова Мария  Младшие...   +7999...   [📞]       │
└──────────────────────────────────────────────────────┘
```

---

## 🎯 Workflow

### Типичный сценарий использования:

#### Понедельник утром:
```
1. Открываете "Статистика"
2. Вкладка "Посещаемость"
3. Проверяете процент за прошлую неделю
4. Видите какие группы пропускают чаще
```

#### Начало месяца:
```
1. Переключаетесь на "Неоплаченные"
2. Выбираете прошлый месяц
3. Видите список должников
4. Звоните каждому через кнопку "Позвонить"
```

#### Конец года:
```
1. Переключаетесь на "Платежи"
2. Выбираете год
3. Анализируете финансовые показатели
4. Планируете бюджет на следующий год
```

---

## 📈 Преимущества

### ✅ Комплексная аналитика
- Посещаемость, платежи, должники в одном месте
- Не нужно переключаться между разными страницами

### ✅ Удобная навигация
- Вкладочный интерфейс
- Интуитивные фильтры
- Автоматическая загрузка данных

### ✅ Детальная информация
- Общая статистика + разбивка по группам
- Список конкретных учеников
- Контакты для связи

### ✅ Быстрые действия
- Кнопка "Позвонить" напрямую
- Смена периодов одним кликом
- Мгновенное обновление данных

---

## 🧪 Тестирование

### Тест 1: Статистика посещаемости
1. Откройте `/statistics`
2. Вкладка "Посещаемость"
3. Выберите текущий месяц
4. ✅ Проверьте отображение общих данных
5. ✅ Проверьте таблицу по группам

### Тест 2: Список неоплативших
1. Переключитесь на "Неоплаченные"
2. Выберите прошлый месяц
3. ✅ Проверьте количество должников
4. ✅ Проверьте корректность данных

### Тест 3: Платежи за год
1. Переключитесь на "Платежи"
2. Выберите текущий год
3. ✅ Проверьте годовые итоги
4. ✅ Проверьте помесячную разбивку

---

## 🚀 Дальнейшие улучшения

### Возможные доработки:

1. **Экспорт в Excel**
   - Выгрузка таблиц в файл
   - Отчеты для бухгалтерии

2. **Графики**
   - Визуализация посещаемости
   - Динамика платежей

3. **SMS-рассылка**
   - Напоминания должникам
   - Массовая отправка

4. **История изменений**
   - Сравнение по месяцам
   - Тренды и прогнозы

---

**Готово! Комплексная статистика работает! 📊💰❌**
