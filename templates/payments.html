{% extends "base.html" %}

{% block title %}Платежи (старая версия) - Sambo Academy{% endblock %}

{% block content %}
        <div class="flex-between mb-2">
            <h1>Платежи и абонементы</h1>
            <div class="flex gap-1">
                <button class="btn btn-primary" onclick="openCreateSubscriptionModal()">+ Создать абонемент</button>
                <button class="btn btn-secondary" onclick="openCreatePaymentModal()">+ Добавить платеж</button>
            </div>
        </div>
        
        <div class="card mb-2">
            <div class="flex gap-2">
                <div class="form-group" style="flex: 1; margin: 0;">
                    <label class="form-label">Месяц</label>
                    <input type="month" id="monthFilter" class="form-input" onchange="loadPayments()">
                </div>
            </div>
        </div>
        
        <div id="paymentsList">
            <div class="spinner"></div>
        </div>

<!-- Create Subscription Modal -->
    <div id="createSubscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Создать абонемент</h2>
                <button class="modal-close" onclick="modal.close('createSubscriptionModal')">&times;</button>
            </div>
            <form id="createSubscriptionForm">
                <div class="form-group">
                    <label class="form-label">Ученик</label>
                    <select name="student_id" id="studentSelect" class="form-select" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Тип абонемента</label>
                    <select name="subscription_type" id="subscriptionType" class="form-select" required>
                        <option value="8_sessions">8 занятий</option>
                        <option value="12_sessions">12 занятий</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Цена</label>
                    <input type="number" name="price" id="subscriptionPrice" class="form-input" step="0.01" required>
                    <small class="text-secondary" id="priceHint"></small>
                </div>
                <div class="form-group">
                    <label class="form-label">Дата начала</label>
                    <input type="date" name="start_date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Дата окончания</label>
                    <input type="date" name="expiry_date" class="form-input" required>
                </div>
                <button type="submit" class="btn btn-primary">Создать</button>
            </form>
        </div>
    </div>
    
    <!-- Create Payment Modal -->
    <div id="createPaymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить платеж</h2>
                <button class="modal-close" onclick="modal.close('createPaymentModal')">&times;</button>
            </div>
            <form id="createPaymentForm">
                <div class="form-group">
                    <label class="form-label">Ученик</label>
                    <select name="student_id" id="studentPaymentSelect" class="form-select" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Сумма</label>
                    <input type="number" name="amount" class="form-input" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Дата платежа</label>
                    <input type="date" name="payment_date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">За какой месяц</label>
                    <input type="month" name="payment_month" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Тип платежа</label>
                    <select name="payment_type" class="form-select" required>
                        <option value="full">Полная оплата</option>
                        <option value="partial">Частичная оплата</option>
                        <option value="discount">Со скидкой</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Статус</label>
                    <select name="status" class="form-select" required>
                        <option value="paid">Оплачено</option>
                        <option value="pending">Ожидается</option>
                        <option value="overdue">Просрочено</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Добавить</button>
            </form>
    </div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/pages/payments.js"></script>
{% endblock %}
