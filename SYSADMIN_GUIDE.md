# üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - Sambo Academy

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 08.10.2025

---

## üéØ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-—Å–∏—Å—Ç–µ–º—ã)
4. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–±–∞–∑–∞–º–∏-–¥–∞–Ω–Ω—ã—Ö)
5. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
6. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-—Å–µ—Ä–≤–µ—Ä–∞)
7. [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–û–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
10. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–ø—Ä–æ–±–ª–µ–º)

---

## üöÄ –í–≤–µ–¥–µ–Ω–∏–µ

–ö–∞–∫ **—Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –≤—ã –æ—Ç–≤–µ—á–∞–µ—Ç–µ –∑–∞:

- ‚úÖ **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ **–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** —Å–µ—Ä–≤–µ—Ä–∞ –∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚úÖ **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã

### –¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏:
- üîß Docker –∏ Docker Compose
- üêò PostgreSQL –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- üåê Nginx –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- üîí SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Linux

---

## üíª –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:**
- CPU: 2 —è–¥—Ä–∞
- RAM: 4 GB
- Disk: 20 GB SSD
- OS: Ubuntu 22.04 LTS / Debian 11

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- CPU: 4 —è–¥—Ä–∞
- RAM: 8 GB
- Disk: 50 GB SSD
- OS: Ubuntu 22.04 LTS

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:**
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:**
   ```bash
   sudo apt install -y curl wget git htop nano ufw fail2ban
   ```

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker:**
   ```bash
   curl -fsSL https://get.docker.com -o get-docker.sh
   sudo sh get-docker.sh
   sudo systemctl enable docker
   sudo systemctl start docker
   ```

4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose:**
   ```bash
   sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
   sudo chmod +x /usr/local/bin/docker-compose
   ```

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   cd /home
   git clone https://github.com/eightspb/sambo_academy.git
   cd sambo_academy
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   cp .env.example .env.production
   nano .env.production
   ```

3. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env.production:**
   ```bash
   # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
   SECRET_KEY=–≤–∞—à_—Å–ª—É—á–∞–π–Ω—ã–π_–∫–ª—é—á_–º–∏–Ω–∏–º—É–º_32_—Å–∏–º–≤–æ–ª–∞

   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
   POSTGRES_DB=sambo_academy
   POSTGRES_USER=sambo_user
   POSTGRES_PASSWORD=—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_–º–∏–Ω–∏–º—É–º_16_—Å–∏–º–≤–æ–ª–æ–≤

   # –î–æ–º–µ–Ω—ã
   FRONTEND_URL=https://sambo-academy.ru
   BACKEND_URL=https://api.sambo-academy.ru

   # SSL
   SSL_CERT_PATH=/etc/letsencrypt/live/sambo-academy.ru/fullchain.pem
   SSL_KEY_PATH=/etc/letsencrypt/live/sambo-academy.ru/privkey.pem
   ```

4. **–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
   ```bash
   sudo docker-compose -f docker-compose.production.yml run --rm app python create_admin.py
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   sudo docker-compose -f docker-compose.production.yml up -d
   ```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

#### docker-compose.production.yml:
```yaml
version: '3.8'
services:
  db:
    image: postgres:15
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}

  app:
    build: .
    depends_on:
      - db
    environment:
      DATABASE_URL: postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl.conf:/etc/nginx/ssl.conf
      - ${SSL_CERT_PATH}:/etc/ssl/certs/sambo-academy.ru.crt
      - ${SSL_KEY_PATH}:/etc/ssl/private/sambo-academy.ru.key
```

#### nginx.conf:
```nginx
events {
    worker_connections 1024;
}

http {
    upstream backend {
        server app:8000;
    }

    server {
        listen 80;
        server_name sambo-academy.ru;
        return 301 https://$server_name$request_uri;
    }

    server {
        listen 443 ssl http2;
        server_name sambo-academy.ru;

        ssl_certificate /etc/ssl/certs/sambo-academy.ru.crt;
        ssl_certificate_key /etc/ssl/private/sambo-academy.ru.key;

        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ certbot:**
   ```bash
   sudo apt install -y certbot python3-certbot-nginx
   ```

2. **–ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
   ```bash
   sudo certbot --nginx -d sambo-academy.ru
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   ```bash
   sudo crontab -e
   # –î–æ–±–∞–≤—å—Ç–µ: 0 3 * * * certbot renew --quiet
   ```

---

## üóÑÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- **groups** - –≥—Ä—É–ø–ø—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- **students** - —É—á–µ–Ω–∏–∫–∏
- **subscriptions** - –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã
- **attendances** - –ø–æ—Å–µ—â–µ–Ω–∏—è
- **payments** - –ø–ª–∞—Ç–µ–∂–∏
- **tournaments** - —Ç—É—Ä–Ω–∏—Ä—ã

#### –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:
```
users (1) ‚îÄ‚îÄ‚îÄ (M) groups
groups (1) ‚îÄ‚îÄ‚îÄ (M) students
students (1) ‚îÄ‚îÄ‚îÄ (M) subscriptions
students (1) ‚îÄ‚îÄ‚îÄ (M) attendances
students (1) ‚îÄ‚îÄ‚îÄ (M) payments
tournaments (1) ‚îÄ‚îÄ‚îÄ (M) tournament_participations
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

#### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
sudo docker-compose exec app alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:
```bash
sudo docker-compose exec app alembic upgrade head
```

#### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
sudo docker-compose exec app alembic downgrade -1
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

1. **–ò–Ω–¥–µ–∫—Å—ã:**
   ```sql
   CREATE INDEX idx_attendance_date ON attendances(session_date);
   CREATE INDEX idx_payments_month ON payments(payment_month);
   ```

2. **VACUUM:**
   ```bash
   sudo docker-compose exec db vacuumdb -U sambo_user -d sambo_academy --full
   ```

3. **–ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü:**
   ```bash
   sudo docker-compose exec db psql -U sambo_user -d sambo_academy -c "ANALYZE;"
   ```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

#### Prometheus + Grafana:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:**
   ```bash
   sudo apt install -y prometheus grafana
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ prometheus.yml:**
   ```yaml
   global:
     scrape_interval: 15s

   scrape_configs:
     - job_name: 'sambo_academy'
       static_configs:
         - targets: ['localhost:8000']
   ```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
# CPU –∏ –ø–∞–º—è—Ç—å
docker stats

# –õ–æ–≥–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
sudo docker-compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
sudo docker-compose logs -f app
```

### –í–∞–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - CPU usage –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
   - Memory consumption
   - Disk I/O
   - Network traffic

2. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
   - HTTP response time
   - Error rates
   - Database connection pool

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - Failed login attempts
   - Suspicious IP addresses
   - Unusual traffic patterns

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤:

**Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
```bash
sudo apt install -y msmtp
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ ~/.msmtprc
```

**Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
```bash
pip install requests
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞

### –ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞:

1. **Firewall:**
   ```bash
   sudo ufw enable
   sudo ufw allow ssh
   sudo ufw allow http
   sudo ufw allow https
   sudo ufw allow 22,80,443/tcp
   ```

2. **Fail2ban:**
   ```bash
   sudo apt install -y fail2ban
   sudo systemctl enable fail2ban
   sudo systemctl start fail2ban
   ```

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
   ```bash
   sudo apt install -y unattended-upgrades
   sudo dpkg-reconfigure -plow unattended-upgrades
   ```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Docker:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ root:**
   ```dockerfile
   RUN useradd -m appuser
   USER appuser
   ```

2. **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞:**
   ```bash
   FROM python:3.11-slim
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
   ```

3. **–°–µ–∫—Ä–µ—Ç—ã –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏:**
   ```bash
   # –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ
   SECRET_KEY=your_secret_key
   ```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
   ```bash
   sudo journalctl -u docker -f
   sudo tail -f /var/log/auth.log
   ```

2. **–ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã:**
   ```bash
   sudo apt install -y auditd
   sudo systemctl enable auditd
   ```

---

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

#### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ
sudo docker-compose exec db pg_dump -U sambo_user sambo_academy > /backups/db_$(date +%Y%m%d).sql

# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø)
sudo docker-compose exec db pg_dump -U sambo_user --clean --if-exists sambo_academy > /backups/db_full_$(date +%Y%m%d).sql
```

#### 2. –§–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ
sudo tar -czf /backups/app_$(date +%Y%m%d).tar.gz /home/sambo_academy/

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
sudo tar -czf /backups/config_$(date +%Y%m%d).tar.gz /home/sambo_academy/.env* /home/sambo_academy/docker-compose*
```

#### 3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç /home/sambo_academy/scripts/backup.sh
#!/bin/bash
BACKUP_DIR="/backups"

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec db pg_dump -U sambo_user sambo_academy > $BACKUP_DIR/db_$(date +%Y%m%d_%H%M%S).sql

# –§–∞–π–ª—ã
tar -czf $BACKUP_DIR/app_$(date +%Y%m%d_%H%M%S).tar.gz /home/sambo_academy/

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find $BACKUP_DIR -type f -name "*.sql" -mtime +30 -delete
find $BACKUP_DIR -type f -name "*.tar.gz" -mtime +30 -delete

# –î–æ–±–∞–≤—å—Ç–µ –≤ cron: 0 2 * * * /home/sambo_academy/scripts/backup.sh
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
sudo docker-compose down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É
sudo docker-compose up -d db
sudo docker-compose exec db psql -U sambo_user sambo_academy < backup.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
sudo docker-compose up -d
```

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
sudo docker-compose down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã
sudo tar -xzf backup.tar.gz -C /

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
sudo docker-compose up -d
```

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

#### Load Balancer:
```nginx
upstream backend {
    server app1:8000;
    server app2:8000;
    server app3:8000;
}

server {
    listen 443 ssl;
    location / {
        proxy_pass http://backend;
    }
}
```

#### –ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```yaml
version: '3.8'
services:
  app1:
    build: .
    environment:
      - INSTANCE_ID=1

  app2:
    build: .
    environment:
      - INSTANCE_ID=2

  app3:
    build: .
    environment:
      - INSTANCE_ID=3
```

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

#### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
docker stats

# –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ docker-compose.yml
app:
  deploy:
    resources:
      limits:
        cpus: '2.0'
        memory: 4G
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:

#### Redis –¥–ª—è —Å–µ—Å—Å–∏–π:
```yaml
services:
  redis:
    image: redis:alpine

  app:
    depends_on:
      - redis
    environment:
      REDIS_URL: redis://redis:6379
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é:**
   ```bash
   sudo docker-compose exec db pg_dump -U sambo_user sambo_academy > backup_pre_update.sql
   ```

2. **–ü–æ–ª—É—á–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
   ```bash
   cd /home/sambo_academy
   git pull origin main
   ```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   sudo docker-compose build --no-cache
   ```

4. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   sudo docker-compose exec app alembic upgrade head
   ```

5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
   ```bash
   sudo docker-compose down
   sudo docker-compose up -d
   ```

6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**
   ```bash
   curl -f https://sambo-academy.ru/api/health
   ```

### –û—Ç–∫–∞—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

1. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   sudo docker-compose exec db psql -U sambo_user sambo_academy < backup_pre_update.sql
   ```

2. **–û—Ç–∫–∞—Ç–∏—Ç–µ git:**
   ```bash
   git reset --hard HEAD~1
   ```

3. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:**
   ```bash
   sudo docker-compose build --no-cache
   sudo docker-compose up -d
   ```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:

#### Docker —Å–µ—Ä–≤–∏—Å—ã:
```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
sudo docker-compose ps

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo docker-compose logs app

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo docker-compose logs db

# –õ–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
sudo docker-compose logs nginx
```

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –ó–∞–≥—Ä—É–∑–∫–∞ CPU
top -n 1

# –°–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
netstat -tuln | grep :80
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤:
```sql
-- –í–∫–ª—é—á–∏—Ç–µ slow query log
ALTER DATABASE sambo_academy SET log_min_duration_statement = 1000;

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
```bash
sudo docker-compose exec db psql -U sambo_user -d sambo_academy -c "SELECT count(*) FROM pg_stat_activity WHERE datname = 'sambo_academy';"
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏:

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS:
```bash
nslookup sambo-academy.ru
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:
```bash
telnet sambo-academy.ru 80
telnet sambo-academy.ru 443
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:
```bash
curl -vI https://sambo-academy.ru
```

### –õ–æ–≥–∏ –æ—à–∏–±–æ–∫:

#### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤:
```bash
# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl -u docker -f

# Nginx –ª–æ–≥–∏
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# Fail2ban
sudo fail2ban-client status
```

---

## üö® –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö

### –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:**
   ```bash
   sudo docker-compose ps
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
   ```bash
   df -h && free -h && top -n 1 -b | head -5
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
   ```bash
   sudo docker-compose restart
   ```

### –ê—Ç–∞–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

1. **–í–∫–ª—é—á–∏—Ç–µ —Å—Ç—Ä–æ–≥–∏–π firewall:**
   ```bash
   sudo ufw --force reset
   sudo ufw allow from your_ip to any port 22
   sudo ufw allow 80,443
   sudo ufw enable
   ```

2. **–ó–∞–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ IP:**
   ```bash
   sudo fail2ban-client set nginx-http-auth banip 192.168.1.100
   ```

3. **–£–≤–µ–¥–æ–º–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

### –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**
2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞–±–æ—á–µ–π –∫–æ–ø–∏–∏**
3. **–°–æ–æ–±—â–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö**

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é:

1. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
   ```bash
   docker stats
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
   ```sql
   SELECT query, calls, total_time, mean_time
   FROM pg_stat_statements
   ORDER BY mean_time DESC
   LIMIT 10;
   ```

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –≠—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º:

**–£—Ä–æ–≤–µ–Ω—å 1:** –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é)
**–£—Ä–æ–≤–µ–Ω—å 2:** –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–£—Ä–æ–≤–µ–Ω—å 3:** –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º

### –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** [–ò–º—è] [–¢–µ–ª–µ—Ñ–æ–Ω] [Email]
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** [–ò–º—è] [–¢–µ–ª–µ—Ñ–æ–Ω] [Email]
**–•–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä:** [–ù–∞–∑–≤–∞–Ω–∏–µ] [–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∏]

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:

1. **–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ**
2. **–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è**
3. **–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –ª–æ–≥–∏ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã**
4. **–£–∫–∞–∂–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏**

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.docker.com/)
- [PostgreSQL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.postgresql.org/docs/)
- [Nginx –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://nginx.org/en/docs/)
- [Prometheus –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://prometheus.io/docs/)
- [Linux —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ](https://linux.die.net/man/)

---

**–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã Sambo Academy! ü•ã**

*–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.*
